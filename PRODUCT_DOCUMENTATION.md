# AkShare MCP Adapter - äº§å“æ–‡æ¡£

## ğŸ“‹ **äº§å“æ¦‚è¿°**

AkShare MCP Adapter æ˜¯ä¸€ä¸ªåŸºäº FastAPI çš„é‡‘èæ•°æ®åˆ†æå¹³å°ï¼Œé›†æˆäº† LLM æ™ºèƒ½åˆ†æåŠŸèƒ½ï¼Œæä¾›ç»Ÿä¸€çš„ MCP (Model Context Protocol) æ¥å£æ¥è®¿é—® AkShare é‡‘èæ•°æ®ã€‚

### **æ ¸å¿ƒç‰¹æ€§**

- ğŸ§  **æ™ºèƒ½LLMåˆ†æ**ï¼šé›†æˆ Google Gemini æ¨¡å‹ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢
- ğŸ“Š **åŒæ¨¡å¼åˆ†æ**ï¼šLLMæ™ºèƒ½æ¨¡å¼ + è§„åˆ™å¿«é€Ÿæ¨¡å¼
- ğŸ”’ **å®‰å…¨è®¤è¯**ï¼šJWTä»¤ç‰Œè®¤è¯ï¼Œç”¨æˆ·æƒé™ç®¡ç†
- ğŸ’¬ **ç°ä»£åŒ–ç•Œé¢**ï¼šå®æ—¶èŠå¤©å¼äº¤äº’ç•Œé¢
- ğŸ§ª **å®Œæ•´æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€APIæµ‹è¯•
- ğŸ“ˆ **æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶ç³»ç»Ÿç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
- ğŸ”§ **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€çš„é…ç½®ç®¡ç†ç³»ç»Ÿ

## ğŸ—ï¸ **ç³»ç»Ÿæ¶æ„**

### **æŠ€æœ¯æ ˆ**
- **åç«¯æ¡†æ¶**: FastAPI + Uvicorn
- **æ•°æ®åº“**: SQLite (å¯æ‰©å±•åˆ° PostgreSQL)
- **LLMæ¨¡å‹**: Google Gemini 1.5 Pro
- **æ•°æ®æº**: AkShare é‡‘èæ•°æ®æ¥å£
- **å‰ç«¯**: HTML5 + JavaScript + CSS3
- **æµ‹è¯•æ¡†æ¶**: pytest + unittest.mock
- **ç›‘æ§**: psutil + è‡ªå®šä¹‰ç›‘æ§ç³»ç»Ÿ

### **æ¨¡å—ç»“æ„**
```
akshare-mcp-adapter/
â”œâ”€â”€ api/                    # APIè·¯ç”±å’Œç«¯ç‚¹
â”œâ”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ mcp_protocol.py    # MCPåè®®å®ç°
â”‚   â”œâ”€â”€ monitoring.py      # æ€§èƒ½ç›‘æ§
â”‚   â””â”€â”€ security.py        # å®‰å…¨è®¤è¯
â”œâ”€â”€ handlers/               # ä¸šåŠ¡é€»è¾‘å¤„ç†å™¨
â”‚   â”œâ”€â”€ llm_handler.py     # LLMæ™ºèƒ½åˆ†æ
â”‚   â”œâ”€â”€ mcp_handler.py     # MCPæ•°æ®å¤„ç†
â”‚   â””â”€â”€ akshare_handler.py # AkShareæ¥å£
â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹
â”œâ”€â”€ static/                 # é™æ€æ–‡ä»¶
â”œâ”€â”€ tests/                  # æµ‹è¯•å¥—ä»¶
â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
```

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **1. ç¯å¢ƒå‡†å¤‡**

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/sys3222/akshare-mcp-adapter.git
cd akshare-mcp-adapter

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
export GEMINI_API_KEY="your-gemini-api-key"
export SECRET_KEY="your-secret-key"
```

### **2. å¯åŠ¨æœåŠ¡**

```bash
# å¼€å‘æ¨¡å¼
python main.py

# æˆ–ä½¿ç”¨ uvicorn
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### **3. è®¿é—®ç•Œé¢**

- **Webç•Œé¢**: http://localhost:8000/static/index.html
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

## ğŸ’¡ **æ ¸å¿ƒåŠŸèƒ½**

### **1. LLMæ™ºèƒ½åˆ†æ**

#### **åŠŸèƒ½ç‰¹æ€§**
- **è‡ªç„¶è¯­è¨€æŸ¥è¯¢**: æ”¯æŒä¸­æ–‡è‡ªç„¶è¯­è¨€è¾“å…¥
- **æ™ºèƒ½æ„å›¾è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨åˆ†æã€å¸‚åœºæ¦‚è§ˆç­‰æ„å›¾
- **å®ä½“æå–**: è‡ªåŠ¨æå–è‚¡ç¥¨ä»£ç ã€æ—¶é—´èŒƒå›´ç­‰å…³é”®ä¿¡æ¯
- **Function Calling**: è‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„æ•°æ®æ¥å£
- **ç»“æ„åŒ–è¾“å‡º**: æä¾›æ‘˜è¦ã€æ´å¯Ÿã€å»ºè®®ã€é£é™©è¯„ä¼°

#### **ä½¿ç”¨ç¤ºä¾‹**
```python
# APIè°ƒç”¨ç¤ºä¾‹
import requests

response = requests.post(
    "http://localhost:8000/api/llm/analyze",
    headers={"Authorization": "Bearer your-token"},
    json={"query": "åˆ†æ000001å¹³å®‰é“¶è¡Œæœ€è¿‘çš„è¡¨ç°"}
)

result = response.json()
print(f"åˆ†ææ‘˜è¦: {result['summary']}")
print(f"æŠ•èµ„å»ºè®®: {result['recommendations']}")
print(f"é£é™©ç­‰çº§: {result['risk_level']}")
```

### **2. åŒæ¨¡å¼åˆ†æ**

#### **LLMæ™ºèƒ½æ¨¡å¼**
- ä½¿ç”¨ Google Gemini æ¨¡å‹
- æ”¯æŒå¤æ‚çš„è‡ªç„¶è¯­è¨€ç†è§£
- æä¾›æ·±åº¦åˆ†æå’Œä¸ªæ€§åŒ–å»ºè®®
- é€‚åˆå¤æ‚æŸ¥è¯¢å’Œå†³ç­–æ”¯æŒ

#### **è§„åˆ™å¿«é€Ÿæ¨¡å¼**
- åŸºäºé¢„å®šä¹‰è§„åˆ™å’Œæ¨¡æ¿
- å“åº”é€Ÿåº¦å¿«ï¼Œèµ„æºæ¶ˆè€—ä½
- é€‚åˆæ ‡å‡†åŒ–æŸ¥è¯¢å’Œæ‰¹é‡å¤„ç†
- ä½œä¸º LLM æ¨¡å¼çš„å›é€€æ–¹æ¡ˆ

### **3. æ•°æ®æ¥å£**

#### **æ”¯æŒçš„æ•°æ®ç±»å‹**
- **è‚¡ç¥¨æ•°æ®**: å®æ—¶è¡Œæƒ…ã€å†å²æ•°æ®ã€è´¢åŠ¡æŒ‡æ ‡
- **å¸‚åœºæ•°æ®**: æŒ‡æ•°æ•°æ®ã€æ¿å—æ•°æ®ã€èµ„é‡‘æµå‘
- **å®è§‚æ•°æ®**: ç»æµæŒ‡æ ‡ã€æ”¿ç­–ä¿¡æ¯
- **æ–°é—»æ•°æ®**: è´¢ç»æ–°é—»ã€å…¬å‘Šä¿¡æ¯

#### **MCPåè®®æ”¯æŒ**
```json
{
  "method": "get_data",
  "params": {
    "interface": "stock_zh_a_hist",
    "symbol": "000001",
    "period": "daily",
    "start_date": "20240101",
    "end_date": "20241231"
  }
}
```

## ğŸ”§ **é…ç½®ç®¡ç†**

### **é…ç½®æ–‡ä»¶ç»“æ„**
```json
{
  "environment": "production",
  "llm": {
    "provider": "gemini",
    "model_name": "gemini-1.5-pro-latest",
    "api_key": "your-api-key",
    "temperature": 0.7,
    "max_tokens": 4096
  },
  "database": {
    "url": "sqlite:///./akshare_mcp.db",
    "echo": false
  },
  "api": {
    "host": "0.0.0.0",
    "port": 8000,
    "cors_origins": ["*"]
  }
}
```

### **ç¯å¢ƒå˜é‡**
- `GEMINI_API_KEY`: Google Gemini APIå¯†é’¥
- `SECRET_KEY`: JWTç­¾åå¯†é’¥
- `DATABASE_URL`: æ•°æ®åº“è¿æ¥URL
- `ENVIRONMENT`: è¿è¡Œç¯å¢ƒ (development/production/testing)

## ğŸ§ª **æµ‹è¯•ä½“ç³»**

### **æµ‹è¯•ç±»å‹**

#### **1. å•å…ƒæµ‹è¯•**
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
python -m pytest tests/unit/ -v --cov=handlers --cov=core
```

#### **2. é›†æˆæµ‹è¯•**
```bash
# è¿è¡Œé›†æˆæµ‹è¯•
python -m pytest tests/integration/ -v
```

#### **3. APIæµ‹è¯•**
```bash
# è¿è¡ŒAPIæµ‹è¯•
python -m pytest tests/unit/test_api_llm.py -v
```

#### **4. å®Œæ•´æµ‹è¯•å¥—ä»¶**
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
bash run_llm_tests.sh
```

### **æµ‹è¯•è¦†ç›–ç‡**
- **ç›®æ ‡è¦†ç›–ç‡**: 80%+
- **æ ¸å¿ƒæ¨¡å—**: handlers/, core/
- **æµ‹è¯•æŠ¥å‘Š**: è‡ªåŠ¨ç”ŸæˆHTMLæŠ¥å‘Š

## ğŸ“Š **æ€§èƒ½ç›‘æ§**

### **ç›‘æ§æŒ‡æ ‡**
- **ç³»ç»ŸæŒ‡æ ‡**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
- **APIæŒ‡æ ‡**: å“åº”æ—¶é—´ã€è¯·æ±‚é‡ã€é”™è¯¯ç‡
- **ä¸šåŠ¡æŒ‡æ ‡**: LLMè°ƒç”¨æ¬¡æ•°ã€åˆ†ææˆåŠŸç‡

### **å¥åº·æ£€æŸ¥**
```bash
# æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€
curl http://localhost:8000/health

# è·å–ç›‘æ§æŒ‡æ ‡
curl http://localhost:8000/api/monitoring/metrics
```

### **æ€§èƒ½åŸºå‡†**
- **APIå“åº”æ—¶é—´**: < 2ç§’ (95%åˆ†ä½)
- **LLMåˆ†ææ—¶é—´**: < 10ç§’
- **å¹¶å‘æ”¯æŒ**: 100+ å¹¶å‘ç”¨æˆ·
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.9%+

## ğŸ”’ **å®‰å…¨ç‰¹æ€§**

### **è®¤è¯æˆæƒ**
- **JWTä»¤ç‰Œ**: åŸºäºJWTçš„æ— çŠ¶æ€è®¤è¯
- **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™æ§åˆ¶
- **ä»¤ç‰Œè¿‡æœŸ**: è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°æœºåˆ¶

### **æ•°æ®å®‰å…¨**
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„è¾“å…¥å‚æ•°éªŒè¯
- **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨ORMé˜²æ­¢SQLæ³¨å…¥
- **XSSé˜²æŠ¤**: è¾“å‡ºå†…å®¹è½¬ä¹‰å¤„ç†
- **CORSé…ç½®**: è·¨åŸŸè¯·æ±‚å®‰å…¨æ§åˆ¶

### **APIå®‰å…¨**
- **é€Ÿç‡é™åˆ¶**: é˜²æ­¢APIæ»¥ç”¨
- **è¯·æ±‚å¤§å°é™åˆ¶**: é˜²æ­¢å¤§æ–‡ä»¶æ”»å‡»
- **é”™è¯¯å¤„ç†**: å®‰å…¨çš„é”™è¯¯ä¿¡æ¯è¿”å›

## ğŸš€ **éƒ¨ç½²æŒ‡å—**

### **å¼€å‘ç¯å¢ƒ**
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python main.py
```

### **ç”Ÿäº§ç¯å¢ƒ**
```bash
# ä½¿ç”¨ Gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker

# ä½¿ç”¨ Docker
docker build -t akshare-mcp-adapter .
docker run -p 8000:8000 akshare-mcp-adapter
```

### **ç¯å¢ƒé…ç½®**
- **å¼€å‘ç¯å¢ƒ**: å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œè¯¦ç»†æ—¥å¿—
- **ç”Ÿäº§ç¯å¢ƒ**: å…³é—­è°ƒè¯•ï¼Œä¼˜åŒ–æ€§èƒ½
- **æµ‹è¯•ç¯å¢ƒ**: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå¿«é€Ÿæµ‹è¯•

## ğŸ“ˆ **æ€§èƒ½ä¼˜åŒ–**

### **ç¼“å­˜ç­–ç•¥**
- **æ•°æ®ç¼“å­˜**: ç¼“å­˜é¢‘ç¹è®¿é—®çš„é‡‘èæ•°æ®
- **ç»“æœç¼“å­˜**: ç¼“å­˜LLMåˆ†æç»“æœ
- **TTLè®¾ç½®**: æ ¹æ®æ•°æ®ç‰¹æ€§è®¾ç½®è¿‡æœŸæ—¶é—´

### **å¹¶å‘ä¼˜åŒ–**
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨ asyncio æé«˜å¹¶å‘æ€§èƒ½
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ± ç®¡ç†
- **è´Ÿè½½å‡è¡¡**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²

### **èµ„æºä¼˜åŒ–**
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡
- **CPUä¼˜åŒ–**: é¿å…é˜»å¡æ“ä½œ
- **ç½‘ç»œä¼˜åŒ–**: å‹ç¼©å“åº”æ•°æ®

## ğŸ”„ **ç»´æŠ¤æŒ‡å—**

### **æ—¥å¿—ç®¡ç†**
- **æ—¥å¿—çº§åˆ«**: DEBUG, INFO, WARNING, ERROR
- **æ—¥å¿—è½®è½¬**: è‡ªåŠ¨æ—¥å¿—æ–‡ä»¶è½®è½¬
- **ç»“æ„åŒ–æ—¥å¿—**: JSONæ ¼å¼æ—¥å¿—è¾“å‡º

### **å¤‡ä»½ç­–ç•¥**
- **æ•°æ®åº“å¤‡ä»½**: å®šæœŸè‡ªåŠ¨å¤‡ä»½
- **é…ç½®å¤‡ä»½**: ç‰ˆæœ¬æ§åˆ¶ç®¡ç†
- **æ—¥å¿—å½’æ¡£**: é•¿æœŸæ—¥å¿—å­˜å‚¨

### **æ›´æ–°æµç¨‹**
1. **ä»£ç æ›´æ–°**: Gitç‰ˆæœ¬æ§åˆ¶
2. **ä¾èµ–æ›´æ–°**: å®šæœŸæ›´æ–°ä¾èµ–åŒ…
3. **é…ç½®è¿ç§»**: å¹³æ»‘é…ç½®å‡çº§
4. **æ•°æ®è¿ç§»**: æ•°æ®åº“ç»“æ„å‡çº§

## ğŸ“ **æŠ€æœ¯æ”¯æŒ**

### **å¸¸è§é—®é¢˜**
- **LLMä¸å¯ç”¨**: æ£€æŸ¥APIå¯†é’¥é…ç½®
- **æ•°æ®è·å–å¤±è´¥**: æ£€æŸ¥ç½‘ç»œè¿æ¥
- **è®¤è¯å¤±è´¥**: æ£€æŸ¥ä»¤ç‰Œæœ‰æ•ˆæ€§
- **æ€§èƒ½é—®é¢˜**: æ£€æŸ¥ç³»ç»Ÿèµ„æº

### **æ•…éšœæ’æŸ¥**
1. **æ£€æŸ¥æ—¥å¿—**: æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. **å¥åº·æ£€æŸ¥**: éªŒè¯æœåŠ¡çŠ¶æ€
3. **é…ç½®éªŒè¯**: ç¡®è®¤é…ç½®æ­£ç¡®
4. **ä¾èµ–æ£€æŸ¥**: éªŒè¯ä¾èµ–å®‰è£…

### **è”ç³»æ–¹å¼**
- **GitHub**: https://github.com/sys3222/akshare-mcp-adapter
- **Issues**: æäº¤é—®é¢˜å’Œå»ºè®®
- **Wiki**: è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

---

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¶é—´**: 2025-07-16  
**ç»´æŠ¤è€…**: AkShare MCP Adapter Team
